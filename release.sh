#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
if [ -n "$(git status --porcelain)" ]; then
  echo "‚ÑπÔ∏è –ù–∞–π–¥–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –î–æ–±–∞–≤–ª—è—é –≤—Å—ë..."
else
  echo "‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ù–µ—á–µ–≥–æ –∫–æ–º–º–∏—Ç–∏—Ç—å."
  exit 0
fi

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üì¶ –í—ã–ø–æ–ª–Ω—è—é 'git add .' ..."
git add .

# –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –≤–µ—Ä—Å–∏—é
if [ -n "$1" ]; then
  VERSION="$1"
else
  read -p "–í–≤–µ–¥–∏—Ç–µ –≤–µ—Ä—Å–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, v3.19.0): " VERSION
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π –≤–≤–æ–¥
if [ -z "$VERSION" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –≤–µ—Ä—Å–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π"
  exit 1
fi

MESSAGE="—Ä–µ–ª–∏–∑_$VERSION"

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–ª–∏–∑ –≤–µ—Ä—Å–∏–∏ $VERSION"

# –ö–æ–º–º–∏—Ç–∏–º —Å –≤–µ—Ä—Å–∏–µ–π –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ–º
git commit -m "$VERSION"

# –ü—É—à–∏–º –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —ç—Ç–æ master)
git push origin master

# –°–æ–∑–¥–∞—ë–º –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–≥
git tag -a "$VERSION" -m "$MESSAGE"

# –ü—É—à–∏–º —Ç–µ–≥
git push origin "$VERSION"

echo "‚úÖ –†–µ–ª–∏—Å $VERSION —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!"